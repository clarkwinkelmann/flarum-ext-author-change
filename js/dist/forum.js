(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var n in e)t.o(e,n)&&!t.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:e[n]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r);const e=flarum.core.compat["common/extend"],n=flarum.core.compat["forum/app"];var o=t.n(n);const a=flarum.core.compat["forum/utils/DiscussionControls"];var s=t.n(a);const i=flarum.core.compat["forum/utils/PostControls"];var c=t.n(i);const l=flarum.core.compat["common/components/Button"];var u=t.n(l);function h(){return h=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},h.apply(this,arguments)}function d(t,r){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},d(t,r)}function f(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,d(t,r)}const p=flarum.core.compat["common/components/Modal"];var g=t.n(p);const y=flarum.core.compat["common/models/Discussion"];var v=t.n(y);const k=flarum.core.compat["common/models/Post"];var b=t.n(k);const S=flarum.core.compat["common/helpers/avatar"];var w=t.n(S);const F=flarum.core.compat["common/helpers/username"];var P=t.n(F);const A=flarum.core.compat["forum/states/SearchState"];var M=t.n(A);const C=flarum.core.compat["common/components/Switch"];var O=t.n(C);const U=flarum.core.compat["forum/components/Search"];var j=t.n(U);const x=flarum.core.compat["common/utils/ItemList"];var B=t.n(x);const E=flarum.core.compat["common/utils/extractText"];var _=t.n(E);const I=flarum.core.compat["forum/components/UsersSearchSource"];var D=function(t){function r(){return t.apply(this,arguments)||this}return f(r,t),r.prototype.view=function(r){var e=t.prototype.view.call(this,r).filter((function(t){return t.attrs&&t.attrs.className&&-1!==t.attrs.className.indexOf("UserSearchResult")}));return 0===e.length?r.length<3?[m("li",u().component({icon:"fas fa-info-circle"},o().translator.trans("clarkwinkelmann-author-change.forum.search.type-more")))]:[m("li",u().component({icon:"fas fa-search-minus"},o().translator.trans("clarkwinkelmann-author-change.forum.search.no-results")))]:(e.forEach((function(t){Array.isArray(t.children)&&t.children.length>0&&(t.children[0].tag="a")})),r.length<3&&e.push(m("li",u().component({icon:"fas fa-info-circle"},o().translator.trans("clarkwinkelmann-author-change.forum.search.type-more")))),e)},r}(t.n(I)()),N=function(t){function r(){return t.apply(this,arguments)||this}f(r,t);var e=r.prototype;return e.selectUserElement=function(t){var r=t.dataset.index;if(r){var e=r.split("users")[1],n=o().store.getById("users",e);this.attrs.onsubmit(n)}},e.oncreate=function(r){var e=this;t.prototype.oncreate.call(this,r),this.$(".Search-results").on("click",(function(t){var r=$(t.target).parents(".UserSearchResult");r.length&&(t.preventDefault(),e.selectUserElement(r.get(0)))}))},e.selectResult=function(){clearTimeout(this.searchTimeout),this.loadingSources=0,this.state.getValue()?this.selectUserElement(this.getItem(this.index).get(0)):this.clear(),this.$("input").trigger("blur")},e.clear=function(){t.prototype.clear.call(this),m.redraw()},e.sourceItems=function(){var t=new(B());return o().forum.attribute("canSearchUsers")&&t.add("users",new D),t},e.view=function(){var r=t.prototype.view.call(this);return r.children[0].children[0].attrs.placeholder=_()(o().translator.trans("clarkwinkelmann-author-change.forum.search.placeholder")),r},r}(j()),T=function(t){function r(){for(var r,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(r=t.call.apply(t,[this].concat(n))||this).user=void 0,r.createdAt=void 0,r.editedAt=void 0,r.syncFirstPost=!1,r.otherModelForFirstPostSync=null,r.attributes={},r.dirty=!1,r.loading=!1,r.userSearchState=void 0,r}f(r,t);var e=r.prototype;return e.oninit=function(r){var e;t.prototype.oninit.call(this,r);var n,a=this.attrs.related,s=a instanceof b()&&a.editedAt();this.user=a.user()||null,this.createdAt=null==(e=a.createdAt())?void 0:e.toISOString().slice(0,16),this.editedAt=s?s.toISOString().slice(0,16):"",this.userSearchState=new(M()),this.userSearchState.getInitialSearch=function(){return""},this.showFirstPostSync()&&(a instanceof v()?(this.otherModelForFirstPostSync=a.firstPost()||null,null===this.otherModelForFirstPostSync&&(this.otherModelForFirstPostSync=o().store.all("posts").find((function(t){return 1===t.number()&&t.discussion()===a}))||null)):this.otherModelForFirstPostSync=a.discussion(),this.otherModelForFirstPostSync&&this.otherModelForFirstPostSync.user()===this.user&&(null==(n=this.otherModelForFirstPostSync.createdAt())?void 0:n.toISOString().slice(0,16))===this.createdAt&&this.createdAt&&(this.syncFirstPost=!0))},e.showFirstPostSync=function(){return this.attrs.related instanceof v()||1===this.attrs.related.number()},e.isPost=function(){return this.attrs.related instanceof b()},e.className=function(){return"Update-Author-Modal"},e.title=function(){return o().translator.trans("clarkwinkelmann-author-change.forum.modal.title-"+(this.isPost()?"post":"discussion"))},e.content=function(){var t=this;return m(".Modal-body",[o().forum.attribute("clarkwinkelmannAuthorChangeCanEditUser")?m(".Form-group",[m("label",o().translator.trans("clarkwinkelmann-author-change.forum.modal.user")),m(".FormControl.SelectedUser",[this.user?u().component({icon:"fas fa-times",onclick:function(){t.user=null,t.attributes.relationships={user:[]},t.dirty=!0},className:"Button Button--icon Button--link RemoveUserButton"}):null,w()(this.user),P()(this.user)]),N.component({state:this.userSearchState,onsubmit:function(r){t.user=r,t.attributes.relationships={user:r},t.dirty=!0,m.redraw()}})]):null,o().forum.attribute("clarkwinkelmannAuthorChangeCanEditDate")?[m(".Form-group",[m("label",o().translator.trans("clarkwinkelmann-author-change.forum.modal.created_at")),m("input.FormControl",{type:"datetime-local",required:!0,value:this.createdAt,onchange:function(r){var e=r.target.value;t.createdAt=e,t.attributes.createdAt=e,t.dirty=!0},disabled:this.loading})]),this.isPost()?m(".Form-group",[m("label",o().translator.trans("clarkwinkelmann-author-change.forum.modal.edited_at")),m("input.FormControl",{type:"datetime-local",value:this.editedAt,onchange:function(r){var e=r.target.value;t.editedAt=e,t.attributes.editedAt=e,t.dirty=!0},disabled:this.loading})]):null]:null,this.showFirstPostSync()?m(".Form-group",[O().component({state:this.syncFirstPost,onchange:function(r){t.syncFirstPost=r,t.dirty=!0,r&&(t.attributes.relationships={user:t.user||[]},t.attributes.createdAt=t.createdAt)},disabled:this.loading||!this.otherModelForFirstPostSync},o().translator.trans("clarkwinkelmann-author-change.forum.modal.sync-with-"+(this.isPost()?"discussion":"post"))),this.otherModelForFirstPostSync?null:m(".helpText",o().translator.trans("clarkwinkelmann-author-change.forum.modal.sync-impossible"))]):null,m(".Form-group",[u().component({disabled:!this.dirty,loading:this.loading,type:"submit",className:"Button Button--primary"},o().translator.trans("clarkwinkelmann-author-change.forum.modal.submit")),u().component({className:"Button CancelButton",onclick:function(){o().modal.close()}},o().translator.trans("clarkwinkelmann-author-change.forum.modal.cancel"))])])},e.saveModel=function(t){return t.save(h({},this.attributes))},e.onsubmit=function(t){var r=this;t.preventDefault(),this.loading=!0,this.saveModel(this.attrs.related).then((function(){return r.syncFirstPost&&r.otherModelForFirstPostSync?r.saveModel(r.otherModelForFirstPostSync):Promise.resolve()})).then((function(){r.loading=!1,r.dirty=!1,m.redraw(),o().modal.close()})).catch((function(t){throw r.loading=!1,m.redraw(),t}))},r}(g());o().initializers.add("clarkwinkelmann-author-change",(function(){(0,e.extend)(s(),"moderationControls",(function(t,r){(o().forum.attribute("clarkwinkelmannAuthorChangeCanEditUser")||o().forum.attribute("clarkwinkelmannAuthorChangeCanEditDate"))&&t.add("clarkwinkelmann-author-change",u().component({icon:"fas fa-user-edit",onclick:function(){o().modal.show(T,{related:r})}},o().translator.trans("clarkwinkelmann-author-change.forum.controls.edit")))})),(0,e.extend)(c(),"moderationControls",(function(t,r){(o().forum.attribute("clarkwinkelmannAuthorChangeCanEditUser")||o().forum.attribute("clarkwinkelmannAuthorChangeCanEditDate"))&&t.add("clarkwinkelmann-author-change",u().component({icon:"fas fa-user-edit",onclick:function(){o().modal.show(T,{related:r})}},o().translator.trans("clarkwinkelmann-author-change.forum.controls.edit")))}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map